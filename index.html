<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mein achtsamer Wochenkalender</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f6f7f8;
  margin: 0;
  padding: 16px;
}

header {
  text-align: center;
  font-size: 20px;
  margin-bottom: 12px;
}

.controls {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}

button {
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  background: #444;
  color: white;
}

.week {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 8px;
}

.day {
  background: white;
  border-radius: 8px;
  padding: 6px;
  min-height: 140px;
}

.day h3 {
  font-size: 14px;
  margin: 4px 0;
}

.column {
  min-height: 60px;
}

.task {
  padding: 6px;
  margin: 4px 0;
  border-radius: 6px;
  font-size: 13px;
  cursor: grab;
}

.task.completed {
  opacity: 0.5;
  text-decoration: line-through;
}

.work { background: #ffd6d6; }
.health { background: #d6f5e6; }
.selfcare { background: #e6e0ff; }
.other { background: #eee; }

.task span {
  float: right;
}
</style>
</head>

<body>

<header>ðŸŒ¿ Mein achtsamer Wochenkalender</header>

<div class="controls">
  <button onclick="changeWeek(-1)">â—€</button>
  <button onclick="goToToday()">Heute</button>
  <button onclick="changeWeek(1)">â–¶</button>
</div>

<div class="week" id="week"></div>

<button onclick="openEditor()">ï¼‹ Neues Todo</button>

<script>
let weekOffset = 0;
let tasks = [];
let editId = null;

const days = ["Montag","Dienstag","Mittwoch","Donnerstag","Freitag"];

function render() {
  const week = document.getElementById("week");
  week.innerHTML = "";

  days.forEach(day => {
    const el = document.createElement("div");
    el.className = "day";
    el.innerHTML = `
      <h3>${day}</h3>
      <div class="column" data-day="${day}" data-col="left"></div>
      <div class="column" data-day="${day}" data-col="right"></div>
    `;
    week.appendChild(el);
  });

  // erst offene, dann erledigte
  [...tasks.filter(t => !t.completed), ...tasks.filter(t => t.completed)]
    .forEach(t => {
      const col = document.querySelector(
        `.column[data-day="${t.day}"][data-col="${t.column}"]`
      );
      if (!col) return;

      const div = document.createElement("div");
      div.className = `task ${t.category} ${t.completed ? "completed" : ""}`;
      div.draggable = true;
      div.innerHTML = `
        ${t.title}
        <span>
          <input type="checkbox" ${t.completed ? "checked" : ""}>
        </span>
      `;

      div.onclick = e => {
        if (e.target.tagName === "INPUT") return;
        editTask(t.id);
      };

      div.querySelector("input").onchange = e => {
        t.completed = e.target.checked;
        render();
      };

      div.ondragstart = e => {
        e.dataTransfer.setData("id", t.id);
      };

      col.ondragover = e => e.preventDefault();
      col.ondrop = e => {
        const id = e.dataTransfer.getData("id");
        const task = tasks.find(x => x.id == id);
        task.day = col.dataset.day;
        task.column = col.dataset.col;
        task.completed = false;
        render();
      };

      col.appendChild(div);
    });
}

function openEditor() {
  const title = prompt("Titel?");
  if (!title) return;

  const day = prompt("Tag (Montagâ€“Freitag)?","Montag");
  const column = prompt("Spalte: left / right","left");
  const category = prompt("Kategorie: work / health / selfcare / other","other");

  tasks.push({
    id: Date.now(),
    title,
    day,
    column,
    category,
    completed: false,
    week: weekOffset
  });

  render();
}

function editTask(id) {
  const t = tasks.find(x => x.id === id);
  if (!t) return;

  t.title = prompt("Titel", t.title) || t.title;
  t.day = prompt("Tag", t.day) || t.day;
  t.column = prompt("Spalte", t.column) || t.column;
  t.category = prompt("Kategorie", t.category) || t.category;

  render();
}

function changeWeek(n) {
  weekOffset += n;
  render();
}

function goToToday() {
  weekOffset = 0;
  render();
}

render();
</script>

</body>
</html>
